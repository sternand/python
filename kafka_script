import sys
from kafka import KafkaProducer, KafkaConsumer


def export_data(argv):
    topicname = "TestTopic"
    kafkabroker = ['10.0.0.4', '10.0.0.5', '10.0.0.6']

    if len(argv) < 1 | len(argv) > 2:
        print("Usage: kafka_write.py <Read[R]/Write[W]> <inputfile>")

    if (argv[0] == "W"):
        # Define:
        iterator = 0
        producer = KafkaProducer(bootstrap_servers=kafkabroker)  # Interne IP der Broker
        # Open local file and send
        with open(argv[1], "r") as file:
            for row in file:
                producer.send(topicname, value=row.encode("utf-8"), key=iterator.str().encode("utf-8"))  # TopicName und dann Eintrag
                iterator += 1
    else:
        # READ
        consumer = KafkaConsumer(bootstrap_servers=kafkabroker, auto_offset_reset='earliest')  # Interne IP der Broker
        consumer.subscribe(topicname)  # TopicName
        for msg in consumer:
            print(msg)


if __name__ == '__main__':
    export_data(sys.argv[1:])
